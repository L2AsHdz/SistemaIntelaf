CREATE SCHEMA SistemaIntelaf;
USE SistemaIntelaf;

CREATE TABLE Empleado (
  Codigo INT NOT NULL,
  Password VARCHAR(30) NOT NULL,
  CUI VARCHAR(13) NOT NULL,
  Nit VARCHAR(10),
  Nombre VARCHAR(45) NOT NULL,
  Telefono VARCHAR(8),
  Correo VARCHAR(30),
  Direccion VARCHAR(50),
  Estado INT NULL DEFAULT 1,
  CONSTRAINT PK_USUARIO
    PRIMARY KEY (Codigo));

CREATE TABLE Tienda (
  Codigo VARCHAR(10) NOT NULL,
  Nombre VARCHAR(30) NOT NULL,
  Direccion VARCHAR(50) NOT NULL,
  Telefono1 VARCHAR(8) NOT NULL,
  Telefono2 VARCHAR(8) NULL,
  Correo VARCHAR(30) NULL,
  Horario VARCHAR(60) NULL,
  CONSTRAINT PK_TIENDA
    PRIMARY KEY (Codigo));

CREATE TABLE TiempoTraslado (
  CodigoTienda1 VARCHAR(10) NOT NULL,
  CodigoTienda2 VARCHAR(10) NOT NULL,
  Tiempo INT NOT NULL,
  CONSTRAINT PK_TIEMPOTRASLADO
    PRIMARY KEY (CodigoTienda1, CodigoTienda2),
  CONSTRAINT FK_TIEMPO_TO_TIENDA1_CODIGO
    FOREIGN KEY (CodigoTienda1)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_TIEMPO_TO_TIENDA2_CODIGO
    FOREIGN KEY (CodigoTienda2)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE Cliente (
  Nit VARCHAR(10) NOT NULL,
  Nombre VARCHAR(45) NOT NULL,
  Telefono VARCHAR(8) NOT NULL,
  CUI VARCHAR(13) NULL,
  CreditoCompra FLOAT NULL,
  Correo VARCHAR(45) NULL,
  Direccion VARCHAR(50) NULL,
  CONSTRAINT PK_CLIETE
    PRIMARY KEY (Nit));

CREATE TABLE Venta (
  Id INT NOT NULL AUTO_INCREMENT,
  NitCliente VARCHAR(10) NOT NULL,
  CodigoTienda VARCHAR(10) NOT NULL,
  Fecha DATE NOT NULL,
  PorcentajeEfectivo FLOAT NULL,
  PorcentajeCredito FLOAT NULL,
  CONSTRAINT PK_VENTA
    PRIMARY KEY (Id),
  CONSTRAINT FK_VENTA_TO_TIENDA_CODIGO
    FOREIGN KEY (CodigoTienda)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_VENTA_TO_CLIENTE_NIT
    FOREIGN KEY (NitCliente)
    REFERENCES Cliente (Nit)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE Producto (
  Codigo VARCHAR(15) NOT NULL,
  Nombre VARCHAR(50) NOT NULL,
  Fabricante VARCHAR(30) NOT NULL,
  Precio FLOAT NOT NULL,
  Descripcion VARCHAR(75) NULL,
  GarantiaMeses INT NULL,
  CONSTRAINT PK_PRODUCTO
    PRIMARY KEY (Codigo));

CREATE TABLE ProductoVenta (
  IdVenta INT NOT NULL,
  CodigoProducto VARCHAR(15) NOT NULL,
  Precio FLOAT NOT NULL,
  Cantidad INT NOT NULL,
  CONSTRAINT PK_PRODUCTOVENTA
    PRIMARY KEY (IdVenta, CodigoProducto),
  CONSTRAINT FK_PRODUCTOV_TO_VENTA_ID
    FOREIGN KEY (IdVenta)
    REFERENCES Venta (Id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PRODUCTOV_TO_PRODUCTO_CODIGO
    FOREIGN KEY (CodigoProducto)
    REFERENCES Producto (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE ExistenciaProducto (
  CodigoTienda VARCHAR(10) NOT NULL,
  CodigoProducto VARCHAR(15) NOT NULL,
  Existencias INT NOT NULL,
  CONSTRAINT PK_EXISTENCIAPRODUCTO
    PRIMARY KEY (CodigoTienda, CodigoProducto),
  CONSTRAINT FK_EXISTENCIA_TO_TIENDA_CODIGO
    FOREIGN KEY (CodigoTienda)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_EXISTENCIA_TO_PRODUCTO_CODIGO
    FOREIGN KEY (CodigoProducto)
    REFERENCES Producto (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE Pedido (
  Codigo INT NOT NULL AUTO_INCREMENT,
  NitCliente VARCHAR(10) NOT NULL,
  CodigoTiendaOrigen VARCHAR(10) NOT NULL,
  CodigoTiendaDestino VARCHAR(10) NOT NULL,
  Fecha DATE NOT NULL,
  FechaVerificacion DATE NULL,
  FechaRetiro DATE NULL,
  PorcentajeEfectivo FLOAT NOT NULL,
  PorcentajeCredito FLOAT NOT NULL,
  PorcentajePagado FLOAT NOT NULL,
  Estado INT NULL DEFAULT 1,
  CONSTRAINT PK_PEDIDO
    PRIMARY KEY (CodigoPedido),
  CONSTRAINT FK_PEDIDO_TO_CLIENTE_NIT
    FOREIGN KEY (NitCliente)
    REFERENCES Cliente (Nit)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PEDIDO_TO_TIENDAO_CODIGO
    FOREIGN KEY (CodigoTiendaOrigen)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PEDIDO_TO_TIENDAD_CODIGO
    FOREIGN KEY (CodigoTiendaDestino)
    REFERENCES Tienda (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);

CREATE TABLE ProductoPedido (
  CodigoPedido INT NOT NULL,
  CodigoProducto VARCHAR(15) NOT NULL,
  Precio FLOAT NOT NULL,
  Cantidad INT NOT NULL,
  CONSTRAINT PK_PRODUCTOPEDIDO
    PRIMARY KEY (CodigoPedido, CodigoProducto),
  CONSTRAINT FK_PRODUCTOD_TO_PEDIDO_CODIGO
    FOREIGN KEY (CodigoPedido)
    REFERENCES Pedido (CodigoPedido)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT,
  CONSTRAINT FK_PRODUCTOD_TO_PRODUCTO_CODIGO
    FOREIGN KEY (CodigoProducto)
    REFERENCES Producto (Codigo)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT);
